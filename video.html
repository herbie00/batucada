<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Batucada ‚Ä¢ Vid√©os</title>
<meta name="theme-color" content="#111" />
<style>
  :root{ --bg:#fff; --fg:#111; --muted:#666; --card:#f6f7f9; --accent:#2563eb; --border:#e6e6e6; }
  @media (prefers-color-scheme: dark){ :root{ --bg:#0c0c0f; --fg:#f5f7fb; --muted:#9aa0a6; --card:#15161a; --accent:#60a5fa; --border:#24262b; } }
  [data-theme="light"]{ --bg:#fff; --fg:#111; --muted:#666; --card:#f6f7f9; --accent:#2563eb; --border:#e6e6e6; }
  [data-theme="dark"]{ --bg:#0c0c0f; --fg:#f5f7fb; --muted:#9aa0a6; --card:#15161a; --accent:#60a5fa; --border:#24262b; }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif}
  header{position:sticky;top:0;z-index:10;border-bottom:1px solid var(--border);backdrop-filter:blur(6px);background:color-mix(in srgb,var(--bg) 85%,transparent)}
  .bar{max-width:980px;margin:0 auto;padding:10px;display:flex;gap:10px;align-items:center}
  .title{font-weight:800}
  .spacer{flex:1}
  .iconbtn{border:1px solid var(--border);background:var(--card);color:var(--fg);border-radius:10px;padding:8px 10px;font-weight:600;cursor:pointer}
  main{max-width:980px;margin:0 auto;padding:16px}
  .player-panel{display:flex;flex-direction:column;gap:12px}
  video{width:100%;border-radius:16px;border:1px solid var(--border);background:#000}
  .control-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .control-row .iconbtn{padding:10px 14px}
  .current-video{font-size:0.95rem;font-weight:600;color:var(--accent)}
  .filter-row{margin:24px 0 12px;display:flex;gap:10px;flex-wrap:wrap}
  .filter-row input,.filter-row select{flex:1;min-width:200px;border-radius:12px;border:1px solid var(--border);padding:10px 12px;background:var(--card);color:var(--fg);font-size:1rem}
  .grid{display:grid;gap:12px;grid-template-columns:1fr}
  @media(min-width:680px){ .grid{grid-template-columns:repeat(2, minmax(0,1fr));} }
  button.card{display:flex;gap:12px;align-items:flex-start;border:1px solid var(--border);background:var(--card);border-radius:14px;padding:12px;text-decoration:none;color:inherit;font:inherit;text-align:left;cursor:pointer;width:100%}
  button.card:focus-visible{outline:3px solid var(--accent);outline-offset:2px}
  .thumb{width:88px;height:64px;flex:0 0 88px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,0.03),transparent);overflow:hidden}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .emoji{font-size:28px}
  @media(min-width:900px){
    .thumb{width:140px;height:110px;flex:0 0 140px}
    .emoji{font-size:48px}
  }
  .meta{flex:1;min-width:0;display:flex;flex-direction:column;gap:6px}
  .meta h2{margin:0;font-size:1.05rem;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;font-weight:700}
  .line2,.line3,.notes{margin:0;font-size:0.95rem;color:var(--muted)}
  .line3{font-weight:500}
  .notes{font-weight:400;font-size:0.85rem}
  .line4{display:flex;flex-wrap:wrap;gap:8px;font-size:0.8rem;color:var(--muted);align-items:center}
  .line4 code{background:var(--bg);border-radius:6px;padding:2px 6px;font-size:0.8rem}
  .tag-row{display:flex;flex-wrap:wrap;gap:6px}
  .tag{border:1px solid var(--border);border-radius:999px;padding:2px 8px;font-size:0.78rem}
  mark{background:var(--accent);color:#fff;border-radius:4px;padding:0 3px}
  .empty-state{padding:32px;border:1px dashed var(--border);border-radius:14px;text-align:center;color:var(--muted)}
  .sr-only{position:absolute;left:-9999px}
</style>
</head>
<body id="app" data-theme="">
<header>
  <div class="bar">
    <div class="title">Batucada ‚Äî Vid√©os</div>
    <div class="spacer"></div>
    <button id="themeBtn" class="iconbtn">üåì Th√®me</button>
  </div>
</header>
<main>
  <section class="player-panel">
    <video id="videoPlayer" controls playsinline preload="metadata">
      <source src="" type="video/mp4" />
      Votre navigateur ne peut pas lire la vid√©o.
    </video>
    <div class="control-row">
      <button id="rewindBtn" class="iconbtn" type="button">‚è™ -10s</button>
      <button id="forwardBtn" class="iconbtn" type="button">+10s ‚è©</button>
      <span class="current-video" id="currentVideoTitle">S√©lectionnez une vid√©o</span>
    </div>
  </section>

  <section class="filter-row">
    <label class="sr-only" for="filterInput">Filtrer les vid√©os</label>
    <input id="filterInput" placeholder="Filtrer par titre, commentaires, tags, date, fichiers..." />
    <label class="sr-only" for="sortSelect">Trier</label>
    <select id="sortSelect">
      <option value="dateDesc">Date (r√©centes)</option>
      <option value="dateAsc">Date (anciennes)</option>
      <option value="titleAsc">Titre A ‚Üí Z</option>
      <option value="titleDesc">Titre Z ‚Üí A</option>
    </select>
  </section>

  <div id="resultCount" class="line3">5 vid√©os</div>
  <section class="grid" id="gallery"></section>
</main>

<script>
  const app=document.getElementById('app');
  const themeBtn=document.getElementById('themeBtn');
  function setTheme(mode){ app.setAttribute('data-theme', mode); try{ localStorage.setItem('bat_theme', mode); }catch{} }
  setTheme(localStorage.getItem('bat_theme')||"");
  themeBtn.onclick=()=>{ const cur=app.getAttribute('data-theme')||""; setTheme(cur==="dark"?"light":cur==="light"?"":"dark"); };

  const videos=[
    {
      id:'rio-banane',
      title:'Rio Banane ‚Äî commentaires et d√©brief',
      description:'Visionnage apr√®s la r√©p√©tition du 11 d√©cembre 2025, commentaires sur les transitions basses.',
      file:'media/06 commentaires apr√®s Rio Banane-saint nic repet 11dec.mp4',
      thumbnail:'media/rio banane image mnemotechnique.png',
      date:'2025-12-11',
      tags:['rio banane','2025','basse','commentaires'],
      comments:['Temps additionnels identifi√©s','Images mn√©motechniques en cours'],
      notes:'Sous-titres et fichier .vtt nomm√©s Rio Banane sont disponibles dans media.',
    },
    {
      id:'bonobo',
      title:'Bonobo ‚Äî restitution',
      description:'Explications du groupe sur le groove de la session Bonobo, avec notes sur les instruments.',
      file:'media/03 commentaires sur bonobo et retravail-saint nic repet 11dec.mp4',
      thumbnail:'',
      date:'2025-12-11',
      tags:['bonobo','groove','commentaires'],
      comments:['√† retravailler les temps quand chaque instrument entre','versions slow + fast'],
      notes:'Fichiers SRT et commentaires √©crits dans le dossier media.',
    },
    {
      id:'pont',
      title:'Tout le monde sur le pont ‚Äî overview',
      description:'Montage rapide des parties chant√©es et percussions avec le suivi des temps.',
      file:'media/05 commentaires tout le monde sur le pont-saint nic repet 11dec.mp4',
      thumbnail:'media/tout le monde sur le pont image mnemotechnique.png',
      date:'2025-12-11',
      tags:['pont','chant','chor√©graphie','2025'],
      comments:['Prendre en compte les break de 8√ó2','Chor√© sur 4 temps'],
      notes:'V√©rifier les partitions associ√©es pour les choeurs.',
    },
    {
      id:'salida',
      title:'Salida ‚Äî retours sur la fin',
      description:'Analyse des transitions folles apr√®s Salida, d√©calages et intensit√©.',
      file:'media/04 commentaires apres salida-saint nic repet 11dec.mp4',
      thumbnail:'',
      date:'2025-12-11',
      tags:['salida','transition','tutti','2025'],
      comments:['Trigger vid√©o pour les tambours','Energia √† stabiliser'],
      notes:'Liens vers fichiers .json et .txt de la s√©ance.',
    },
    {
      id:'tutos',
      title:'Tutoriels 2025 ‚Äî virade tambourims',
      description:'Compilation des prises tutoriels, playlist mentionn√©e dans l‚Äôindex.',
      file:'media/Tutoriels-2025-virade-tambourims.mp4',
      thumbnail:'',
      date:'2025-12-08',
      tags:['tutoriels','virade','tambourims','2025'],
      comments:['Nouveau module VIRADE','Pr√©voir int√©gration dans les prochains cours'],
      notes:'Ajouter les autres tutos quand pr√™ts.',
    }
  ];

  const gallery=document.getElementById('gallery');
  const player=document.getElementById('videoPlayer');
  const sourceEl=player.querySelector('source');
  const currentTitle=document.getElementById('currentVideoTitle');
  const filterInput=document.getElementById('filterInput');
  const sortSelect=document.getElementById('sortSelect');
  const resultCount=document.getElementById('resultCount');
  const rewindBtn=document.getElementById('rewindBtn');
  const forwardBtn=document.getElementById('forwardBtn');

  function escapeHtml(str){ return str.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;'); }
  function escapeRegExp(str){ return str.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }
  function highlight(text, query){
    const escaped=escapeHtml(text||'');
    if(!query) return escaped;
    const regex=new RegExp(`(${escapeRegExp(query)})`,'gi');
    return escaped.replace(regex,'<mark>$1</mark>');
  }
  function matches(video, term){
    if(!term) return true;
    const combined=[video.title, video.description, video.comments.join(' '), video.tags.join(' '), video.date, video.file, video.notes].join(' ').toLowerCase();
    return combined.includes(term);
  }
  function sortVideos(list, mode){
    return [...list].sort((a,b)=>{
      const dateA=new Date(a.date);
      const dateB=new Date(b.date);
      switch(mode){
        case 'dateAsc': return dateA-dateB;
        case 'dateDesc': return dateB-dateA;
        case 'titleAsc': return a.title.localeCompare(b.title,'fr',{sensitivity:'base'});
        case 'titleDesc': return b.title.localeCompare(a.title,'fr',{sensitivity:'base'});
        default: return dateB-dateA;
      }
    });
  }
  function loadVideo(video){
    if(!video) return;
    sourceEl.src=video.file;
    player.load();
    player.dataset.activeId=video.id;
    currentTitle.textContent=`‚ñ∂ ${video.title} ‚Äî ${video.date}`;
  }
  function renderGallery(){
    const queryRaw=filterInput.value.trim();
    const query=queryRaw.toLowerCase();
    const visible=sortVideos(videos.filter(v=>matches(v,query)),sortSelect.value);
    resultCount.textContent=`${visible.length} vid√©o${visible.length>1?'s':''}`;
    if(!visible.length){
      gallery.innerHTML='<div class="empty-state">Aucune vid√©o ne correspond √† ce filtre.</div>';
      sourceEl.removeAttribute('src');
      player.load();
      currentTitle.textContent='S√©lectionnez une vid√©o';
      delete player.dataset.activeId;
      return;
    }
    const cards=visible.map(video=>{
      const thumbHtml=video.thumbnail?`<img src="${video.thumbnail}" alt="${escapeHtml(video.title)}">`:`<span class="emoji" aria-hidden="true">üé¨</span>`;
      const commentLine=video.comments.length?video.comments.join(' ¬∑ '):'Pas de commentaires enregistr√©s';
      return `
        <button class="card" type="button" data-video-id="${video.id}">
          <div class="thumb">${thumbHtml}</div>
          <div class="meta">
            <h2>${highlight(video.title, queryRaw)}</h2>
            <p class="line2">${highlight(video.description, queryRaw)}</p>
            <p class="line3">${highlight(commentLine, queryRaw)}</p>
            <p class="notes">${highlight(video.notes, queryRaw)}</p>
            <div class="line4">
              <span>${highlight(video.date, queryRaw)}</span>
              <code>${highlight(video.file, queryRaw)}</code>
            </div>
            <div class="tag-row">
              ${video.tags.map(tag=>`<span class="tag">${highlight(tag, queryRaw)}</span>`).join('')}
            </div>
          </div>
        </button>`;
    }).join('');
    gallery.innerHTML=cards;
    gallery.querySelectorAll('button.card').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const next=visible.find(v=>v.id===btn.dataset.videoId);
        if(next) loadVideo(next);
      });
    });
    if(!player.dataset.activeId || !visible.some(v=>v.id===player.dataset.activeId)){
      loadVideo(visible[0]);
    }
  }

  filterInput.addEventListener('input',renderGallery);
  sortSelect.addEventListener('change',renderGallery);

  rewindBtn.addEventListener('click',()=>{
    if(!player.src) return;
    player.currentTime=Math.max(0,player.currentTime-10);
  });
  forwardBtn.addEventListener('click',()=>{
    if(!player.src) return;
    const target=player.currentTime+10;
    player.currentTime=Math.min(target,Number.isFinite(player.duration)?player.duration:target);
  });

  renderGallery();
</script>
</body>
</html>