<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Batucada ‚Ä¢ Morceau (v0.4.5)</title>
<meta name="theme-color" content="#111" />
<style>
  :root{
    --bg:#fff; --fg:#111; --muted:#666; --card:#f6f7f9; --accent:#2563eb; --border:#e6e6e6;
    --header-h:56px;
  }
  @media (prefers-color-scheme: dark){
    :root{ --bg:#0c0c0f; --fg:#f5f7fb; --muted:#9aa0a6; --card:#15161a; --accent:#60a5fa; --border:#24262b; }
  }
  [data-theme="light"]{ --bg:#fff; --fg:#111; --muted:#666; --card:#f6f7f9; --accent:#2563eb; --border:#e6e6e6; }
  [data-theme="dark"]{ --bg:#0c0f12; --fg:#f5f7fb; --muted:#9aa0a6; --card:#15161a; --accent:#60a5fa; --border:#24262b; }

  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif}
  body{touch-action:pan-y pinch-zoom;}

  header{
    position:sticky; top:0; z-index:20;
    border-bottom:1px solid var(--border);
    backdrop-filter:blur(6px);
    background:color-mix(in srgb,var(--bg) 85%,transparent)
  }
  .bar{max-width:980px;margin:0 auto;padding:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .title{font-weight:800}
  .spacer{flex:1;min-width:10px}
  .iconbtn{border:1px solid var(--border);background:var(--card);color:var(--fg);
           border-radius:10px;padding:6px 9px;font-size:.85rem;font-weight:600;text-decoration:none}
  .pill{font-size:.75rem;border-radius:999px;padding:4px 8px;border:1px solid var(--border);background:var(--card)}

  .playerSticky{
    position:sticky;
    top:calc(var(--header-h) + 4px);
    z-index:18;
  }
  .playerCard{
    margin:4px auto;
    padding:4px 8px;
    border:1px solid var(--border);
    border-radius:12px;
    background:var(--card);
    max-width:980px;
  }
  .playerCard h2{
    font-size:.9rem;
    margin:0 0 2px;
  }
  audio{
    width:100%;
    height:32px;
  }
  .audioDebug{
    margin-top:2px;
    font-size:.75rem;
    color:var(--muted);
  }
  .audioDebug a{color:var(--accent);text-decoration:none;}

  /* En plein √©cran on compresse le lecteur (on cache le texte pour gagner de la place) */
  body.fs-open .playerCard h2,
  body.fs-open .audioDebug{display:none;}

  main{max-width:980px;margin:0 auto;padding:10px 10px 40px}
  .note{font-size:.9rem;color:var(--muted);margin:4px 0 8px}
  .note strong{font-weight:700}

  .sections{display:grid;gap:10px;grid-template-columns:1fr;margin-top:8px}
  @media(min-width:700px){ .sections{ grid-template-columns:repeat(2, minmax(0,1fr)); } }

  .part{
    border:1px solid var(--border);
    border-radius:12px;
    overflow:hidden;
    background:var(--card);
    outline:none;
  }
  .part:focus-visible{outline:2px solid var(--accent);outline-offset:2px;}
  .partHead{
    display:flex;
    align-items:center;
    gap:6px;
    padding:6px 8px;
    border-bottom:1px solid var(--border)
  }
  .partHead h3{
    font-size:.95rem;
    margin:0;
    flex:1;
    cursor:pointer;
  }

  .playbtn{
    border:1px solid var(--border);
    background:var(--fg);
    color:var(--bg);
    padding:4px 8px;
    border-radius:999px;
    cursor:pointer;
    font-weight:700;
    font-size:.75rem;
  }
  .playbtn:hover{filter:brightness(1.05);}

  .sheet.hasimg{padding:0;background:none;cursor:pointer}
  .sheet.hasimg img{display:block;width:100%;height:auto;border:0}

  .sheet.noimg{
    min-height:40px;height:40px;display:flex;align-items:center;
    padding:4px 8px;background:none!important;
  }
  .sheet.noimg .label{
    background:var(--card);border:1px solid var(--border);padding:4px 8px;
    border-radius:16px;font-size:.8rem;font-weight:600;
  }

  .meta{
    display:flex;
    gap:8px;
    align-items:center;
    padding:6px 8px;
    color:var(--muted);
    font-size:.75rem
  }
  .dot{width:6px;height:6px;border-radius:50%;background:var(--accent)}

  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
  .error{color:#f97373;font-size:.9rem;margin-top:6px}

  /* Visionneuse plein √©cran */
  .fsOverlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.95);
    color:#f9fafb;
    display:none;
    z-index:40;
    align-items:flex-start;
    justify-content:center;
    padding:10px 0 80px;
  }
  .fsOverlay.open{display:flex;}
  .fsInner{
    position:relative;
    width:100%;
    max-width:1024px;
    max-height:100vh;
    padding:0 10px;
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .fsClose{
    position:absolute;
    top:6px; right:18px;
    border:none;
    background:rgba(15,23,42,0.8);
    color:#f9fafb;
    border-radius:999px;
    padding:4px 9px;
    cursor:pointer;
    font-size:.8rem;
    z-index:5;
  }
  .fsImageWrap{
    flex:1;
    display:flex;
    align-items:flex-start;
    justify-content:flex-start;  /* image ancr√©e √† gauche */
    padding:10px 2px 0;
    overflow:auto;
  }
  .fsImageWrap img{
    max-width:100%;
    max-height:60vh;
    object-fit:contain;
    background:#000;
    transition:transform 0.15s ease;
  }
  .fsImageWrap img.zoomed{
    max-width:none;
    max-height:none;
    transform:scale(1.7);       /* zoom clair */
    transform-origin:top left;
  }

  .fsMeta{
    border-radius:14px;
    background:rgba(15,23,42,0.96);
    padding:8px 10px;
    font-size:.85rem;
    display:flex;
    flex-direction:column;
    gap:4px;
  }
  .fsLabel{font-weight:700;}
  .fsTime{font-size:.8rem;color:#e5e7eb;}

  .fsNavRow{
    margin-top:2px;
    display:flex;
    align-items:center;
    gap:6px;
  }
  .fsNavBtn{
    flex:1;
    border:1px solid rgba(148,163,184,0.7);
    background:transparent;
    color:#e5e7eb;
    border-radius:999px;
    padding:4px 6px;
    font-size:.72rem;
    cursor:pointer;
    text-align:left;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .fsNavBtn.right{text-align:right;}
  .fsNavBtn.disabled{opacity:0.3;cursor:default;}

  .fsControlsRow{
    margin-top:4px;
    display:flex;
    align-items:center;
    gap:6px;
    flex-wrap:wrap;
  }
  .fsPlayBtn{
    border:none;
    background:#22c55e;
    color:#022c22;
    padding:4px 10px;
    border-radius:999px;
    font-weight:700;
    cursor:pointer;
    font-size:.8rem;
    white-space:nowrap;
  }
  .fsPlayBtn:hover{filter:brightness(1.05);}
  .fsZoomBtn{
    border:none;
    background:#eab308;
    color:#422006;
    padding:4px 8px;
    border-radius:999px;
    font-weight:600;
    cursor:pointer;
    font-size:.8rem;
    white-space:nowrap;
  }
  .fsZoomBtn:hover{filter:brightness(1.05);}

  .btn-primary{
    border:none;
    background:#22c55e;
    color:#022c22;
    padding:4px 10px;
    border-radius:999px;
    font-weight:700;
    font-size:.8rem;
    cursor:pointer;
    white-space:nowrap;
  }
  .btn-secondary{
    border:none;
    background:#eab308;
    color:#422006;
    padding:4px 8px;
    border-radius:999px;
    font-weight:600;
    font-size:.8rem;
    cursor:pointer;
    white-space:nowrap;
  }

  .changelog{
    max-width:980px;margin:8px auto 40px;border:1px dashed var(--border);
    border-radius:10px;background:var(--card);padding:8px 10px;display:none;font-size:.8rem;
  }
  .changelog.open{display:block}
  .changelog h4{margin:0 0 4px;font-size:.85rem}
  .small{font-size:.8rem;color:var(--muted);}
</style>
</head>
<body id="app" data-theme="">
<header>
  <div class="bar" id="hdr">
    <a class="iconbtn" href="index.html">‚Üê Morceaux</a>
    <div class="title" id="songTitle">Morceau</div>
    <span class="pill">v0.4.5</span>
    <div class="spacer"></div>
    <button id="themeBtn" class="iconbtn">üåì Th√®me</button>
    <button id="changelogBtn" class="iconbtn">üìù Changelog</button>
  </div>
</header>

<div class="playerSticky">
  <section class="playerCard" aria-labelledby="fullTrackTitle">
    <h2 id="fullTrackTitle">√âcoutez le morceau en entier</h2>
    <audio id="player" controls preload="metadata">
      <source id="audioSrc" src="" />
      Votre navigateur ne supporte pas la balise audio.
    </audio>
    <div id="audioDebug" class="audioDebug"></div>
  </section>
</div>

<main>
  <p class="note">
    Touchez ‚ñ∂ ou le titre d‚Äôune section pour y sauter. Touchez une image pour l‚Äôouvrir en plein √©cran.
  </p>

  <section aria-labelledby="partsTitle">
    <h2 id="partsTitle" class="sr-only">Sections (partitions)</h2>
    <div id="sections" class="sections"></div>
  </section>
</main>

<!-- Visionneuse plein √©cran -->
<div id="fsOverlay" class="fsOverlay" aria-hidden="true">
  <div class="fsInner" id="fsInner">
    <button id="fsClose" class="fsClose" type="button">‚úï Fermer</button>
    <div class="fsImageWrap" id="fsImageWrap">
      <img id="fsImage" src="" alt="Partition en plein √©cran">
    </div>
    <div class="fsMeta">
      <div id="fsLabel" class="fsLabel"></div>
      <div id="fsTime" class="fsTime"></div>
      <div class="fsNavRow">
        <button id="fsPrev" class="fsNavBtn left" type="button"></button>
        <button id="fsNext" class="fsNavBtn right" type="button"></button>
      </div>
      <div class="fsControlsRow">
        <button id="fsPlay" class="fsPlayBtn" type="button">‚ñ∂ Lire √† partir d‚Äôici</button>
        <button id="fsZoom" class="fsZoomBtn" type="button">üîç Zoom</button>
      </div>
    </div>
  </div>
</div>

<section id="changelog" class="changelog">
  <h4>Changelog</h4>
  <ul class="small">
    <li><strong>v0.4.5</strong> ‚Äî Zoom clair (scale) avec d√©filement, lecteur √† nouveau en haut (sticky), texte du lecteur masqu√© en plein √©cran.</li>
    <li><strong>v0.4.4</strong> ‚Äî corrections image plein √©cran & espacement.</li>
    <li><strong>v0.4.3</strong> ‚Äî visionneuse plein √©cran initiale.</li>
  </ul>
</section>

<script>
  const app=document.getElementById('app');
  const themeBtn=document.getElementById('themeBtn');
  const logBtn=document.getElementById('changelogBtn');
  const logPanel=document.getElementById('changelog');
  const headerEl=document.getElementById('hdr');

  function setTheme(m){
    app.setAttribute('data-theme', m);
    try{localStorage.setItem('bat_theme', m);}catch{}
  }
  setTheme(localStorage.getItem('bat_theme')||"");
  themeBtn.onclick=()=>{
    const cur=app.getAttribute('data-theme')||"";
    setTheme(cur==="dark"?"light":cur==="light"?"":"dark");
  };
  logBtn.onclick=()=>{
    logPanel.classList.toggle('open');
    logPanel.scrollIntoView({behavior:'smooth',block:'nearest'});
  };
  function syncHeaderH(){
    document.documentElement.style.setProperty('--header-h', headerEl.offsetHeight + 'px');
  }
  window.addEventListener('resize', syncHeaderH, {passive:true});
  syncHeaderH();

  const el=(s,r=document)=>r.querySelector(s);
  const q=new URLSearchParams(location.search);
  const baseSlug = (q.get('id') || "").trim();
  const sectionsWrap = el('#sections');
  const player = el('#player');
  const audioSrc = el('#audioSrc');
  const audioDebug = el('#audioDebug');
  const songTitle = el('#songTitle');

  let loopRAF=null;
  function clearLoop(){ if(loopRAF) cancelAnimationFrame(loopRAF); loopRAF=null; player.loop=false; }

  function playSegment(start,end){
    clearLoop();
    let s = start !== undefined && start !== "" ? Number(start) : 0;
    let e = end   !== undefined && end   !== "" ? Number(end)   : NaN;
    if(!Number.isFinite(s)) s = 0;

    if(player.readyState === 0){ player.load(); }

    player.pause();
    player.currentTime = Math.max(0,s);

    const p = player.play();
    if(p && p.catch){ p.catch(()=>{}); }

    if(Number.isFinite(e)){
      const startPos = player.currentTime;
      const endPos = Math.max(startPos + 0.25, e);
      const tick=()=>{ if(player.currentTime>=endPos) player.currentTime=startPos; loopRAF=requestAnimationFrame(tick); };
      loopRAF=requestAnimationFrame(tick);
    }
  }

  player.addEventListener('seeking', clearLoop);
  player.addEventListener('ended', clearLoop);

  player.addEventListener('loadedmetadata', ()=>{
    audioDebug.innerHTML = `Audio charg√© ‚úî (dur√©e&nbsp;: ${player.duration.toFixed(1)} s)`;
  });

  player.addEventListener('error', ()=>{
    const src = audioSrc.src || '(aucun)';
    audioDebug.innerHTML = `<span class="error">Erreur de chargement audio :</span> <code>${src}</code><br>
      V√©rifie que le fichier existe bien √† cette adresse (casse exacte, dossier, etc.).`;
  });

  function formatTime(sec){
    if(!Number.isFinite(sec)) return "‚Äî";
    return sec.toFixed(1).replace('.', ',');
  }

  async function loadSongData(){
    if(!baseSlug){
      sectionsWrap.innerHTML='<p class="error">Param√®tre manquant : <code>?id=slug</code></p>';
      return null;
    }
    const names=[];
    names.push(baseSlug);
    names.push(baseSlug.toLowerCase());
    const cap = baseSlug.charAt(0).toUpperCase() + baseSlug.slice(1).toLowerCase();
    names.push(cap);

    const tried=[];
    for(const name of names){
      const clean=name.trim(); if(!clean) continue;
      const url=`songs/${clean}.json`;
      tried.push(url);
      try{
        const res=await fetch(url,{cache:'no-cache'});
        if(res.ok){ return await res.json(); }
      }catch(e){}
    }
    const last=tried[tried.length-1] || `songs/${baseSlug}.json`;
    sectionsWrap.innerHTML = `<p class="error">Erreur de chargement de <code>${last}</code>. V√©rifie le nom exact du fichier JSON.</p>`;
    return null;
  }

  const fsOverlay = el('#fsOverlay');
  const fsImage   = el('#fsImage');
  const fsImageWrap = el('#fsImageWrap');
  const fsLabel   = el('#fsLabel');
  const fsTime    = el('#fsTime');
  const fsPrev    = el('#fsPrev');
  const fsNext    = el('#fsNext');
  const fsPlay    = el('#fsPlay');
  const fsClose   = el('#fsClose');
  const fsZoom    = el('#fsZoom');

  let parts = [];
  let fsItems = [];
  let fsIndex = 0;
  let fsZoomed = false;

  function buildFsItems(){
    fsItems = [];
    parts.forEach((p,sectionIndex)=>{
      const imgs = Array.isArray(p.images) ? p.images : (p.images ? [p.images] : []);
      imgs.forEach((src,imageIndex)=>{
        fsItems.push({sectionIndex,imageIndex,src});
      });
    });
  }

  function openFullscreenFor(sectionIndex,imageIndex){
    if(!fsItems.length) return;
    const idx = fsItems.findIndex(it => it.sectionIndex===sectionIndex && it.imageIndex===imageIndex);
    if(idx === -1) return;
    fsIndex = idx;
    fsZoomed = false;
    fsImage.classList.remove('zoomed');
    updateZoomButton();
    updateFsView();
    document.body.classList.add('fs-open');
    fsOverlay.classList.add('open');
    fsOverlay.setAttribute('aria-hidden','false');
  }

  function closeFullscreen(){
    fsOverlay.classList.remove('open');
    fsOverlay.setAttribute('aria-hidden','true');
    document.body.classList.remove('fs-open');
  }

  function updateZoomButton(){
    fsZoom.textContent = fsZoomed ? "üîé R√©duire" : "üîç Zoom";
  }

  function updateFsView(){
    if(!fsItems.length) return;
    const item = fsItems[fsIndex];
    const part = parts[item.sectionIndex];
    if(!part) return;

    fsImage.src = item.src;
    fsImage.alt = part.label || "Partition";

    const totalImgs = Array.isArray(part.images) ? part.images.length : (part.images ? 1 : 0);
    let label = part.label || `Section ${item.sectionIndex+1}`;
    if(totalImgs>1){
      label += ` (${item.imageIndex+1}/${totalImgs})`;
    }
    fsLabel.textContent = label;
    fsTime.textContent = `Rep√®re : ${formatTime(part.start)} s ‚Üí ${formatTime(part.end)} s`;

    const prevSectionIndex = item.sectionIndex>0 ? item.sectionIndex-1 : null;
    const nextSectionIndex = item.sectionIndex < parts.length-1 ? item.sectionIndex+1 : null;

    if(prevSectionIndex===null){
      fsPrev.textContent = '';
      fsPrev.classList.add('disabled');
    }else{
      const pPrev = parts[prevSectionIndex];
      fsPrev.textContent = `‚Üê ${pPrev.label || 'Section'} ‚Ä¢ ${formatTime(pPrev.start)}‚Äì${formatTime(pPrev.end)} s`;
      fsPrev.classList.remove('disabled');
    }

    if(nextSectionIndex===null){
      fsNext.textContent = '';
      fsNext.classList.add('disabled');
    }else{
      const pNext = parts[nextSectionIndex];
      fsNext.textContent = `${pNext.label || 'Section'} ‚Ä¢ ${formatTime(pNext.start)}‚Äì${formatTime(pNext.end)} s ‚Üí`;
      fsNext.classList.remove('disabled');
    }

    if(fsZoomed){
      fsImageWrap.scrollLeft = 0;
      fsImageWrap.scrollTop = 0;
    }
  }

  function showFsIndex(newIndex){
    if(!fsItems.length) return;
    if(newIndex<0 || newIndex>=fsItems.length) return;
    fsIndex = newIndex;
    updateFsView();
  }

  fsClose.addEventListener('click', closeFullscreen);
  fsOverlay.addEventListener('click', (e)=>{
    if(e.target === fsOverlay){ closeFullscreen(); }
  });
  document.addEventListener('keydown', (e)=>{
    if(!fsOverlay.classList.contains('open')) return;
    if(e.key === 'Escape'){ closeFullscreen(); }
    if(e.key === 'ArrowLeft' && !fsZoomed){ showFsIndex(fsIndex-1); }
    if(e.key === 'ArrowRight' && !fsZoomed){ showFsIndex(fsIndex+1); }
  });

  fsPrev.addEventListener('click', ()=>{
    const currentSection = fsItems[fsIndex]?.sectionIndex;
    if(currentSection == null || currentSection<=0) return;
    const targetSection = currentSection-1;
    const idx = fsItems.findIndex(it=>it.sectionIndex===targetSection);
    if(idx>=0) showFsIndex(idx);
  });
  fsNext.addEventListener('click', ()=>{
    const currentSection = fsItems[fsIndex]?.sectionIndex;
    if(currentSection == null || currentSection>=parts.length-1) return;
    const targetSection = currentSection+1;
    const idx = fsItems.findIndex(it=>it.sectionIndex===targetSection);
    if(idx>=0) showFsIndex(idx);
  });
  fsPlay.addEventListener('click', ()=>{
    const item = fsItems[fsIndex];
    if(!item) return;
    const part = parts[item.sectionIndex];
    if(!part) return;
    playSegment(part.start, part.end);
  });
  fsZoom.addEventListener('click', ()=>{
    fsZoomed = !fsZoomed;
    fsImage.classList.toggle('zoomed', fsZoomed);
    updateZoomButton();
    if(fsZoomed){
      fsImageWrap.scrollLeft = 0;
      fsImageWrap.scrollTop = 0;
    }
  });

  let touchStartX=null, touchStartY=null;
  fsOverlay.addEventListener('touchstart', (e)=>{
    if(fsZoomed){ touchStartX=null; touchStartY=null; return; }
    if(e.touches.length!==1) return;
    const t=e.touches[0];
    touchStartX=t.clientX;
    touchStartY=t.clientY;
  }, {passive:true});
  fsOverlay.addEventListener('touchend', (e)=>{
    if(fsZoomed) return;
    if(touchStartX===null) return;
    const t=e.changedTouches[0];
    const dx=t.clientX-touchStartX;
    const dy=t.clientY-touchStartY;
    const absX=Math.abs(dx), absY=Math.abs(dy);
    touchStartX=touchStartY=null;
    if(absX<40 || absX<absY) return;
    if(dx<0){ showFsIndex(fsIndex+1); }
    else{ showFsIndex(fsIndex-1); }
  }, {passive:true});

  async function init(){
    const data = await loadSongData();
    if(!data) return;

    songTitle.textContent = data.title || baseSlug;
    parts = data.parts || [];

    if(data.audio){
      audioSrc.src = data.audio;
      player.load();
      const href = new URL(data.audio, window.location.href).toString();
      audioDebug.innerHTML = `Chemin audio : <code>${data.audio}</code> ‚Äî <a href="${href}" target="_blank" rel="noopener">Tester le fichier audio</a>`;
    }else{
      audioDebug.innerHTML = `<span class="error">Aucun chemin audio d√©fini dans le JSON.</span>`;
    }

    sectionsWrap.innerHTML='';
    parts.forEach((p, idx)=>{
      const art=document.createElement('article');
      art.className='part';
      art.setAttribute('tabindex','0');
      if(p.start !== undefined) art.dataset.start = p.start;
      if(p.end   !== undefined) art.dataset.end   = p.end;

      const label = p.label || `Partie ${idx+1}`;
      const startTxt = Number.isFinite(p.start) ? Number(p.start).toFixed(1) : '‚Äî';
      const endTxt   = Number.isFinite(p.end)   ? ` ‚Ä¢ fin : ${Number(p.end).toFixed(1)} s` : '';

      const imgs = Array.isArray(p.images) ? p.images : (p.images ? [p.images] : []);
      const firstImg = imgs.length ? imgs[0] : null;

      art.innerHTML = `
        <div class="partHead">
          <button class="playbtn" type="button">‚ñ∂</button>
          <h3>${label}</h3>
        </div>
        ${firstImg ? `
          <figure class="sheet hasimg" aria-label="${label}">
            <img src="${firstImg}" alt="${label}" loading="lazy" decoding="async">
          </figure>
        ` : `
          <figure class="sheet noimg" aria-label="${label}">
            <span class="label">${label}</span>
          </figure>
        `}
        <div class="meta"><span class="dot"></span> Rep√®re : ${startTxt} s${endTxt}</div>
      `;

      const doPlay = ()=> playSegment(p.start, p.end);
      art.querySelector('.playbtn').addEventListener('click', doPlay);
      art.querySelector('h3').addEventListener('click', doPlay);

      const fig = art.querySelector('figure.sheet.hasimg');
      if(fig){
        fig.dataset.secIndex = idx;
        fig.dataset.imgIndex = 0;
        fig.addEventListener('click', (e)=>{
          e.stopPropagation();
          const sec = parseInt(fig.dataset.secIndex,10) || 0;
          const imgIndex = parseInt(fig.dataset.imgIndex,10) || 0;
          openFullscreenFor(sec,imgIndex);
        });
      }

      sectionsWrap.appendChild(art);
    });

    buildFsItems();

    sectionsWrap.addEventListener('click', (e)=>{
      let t=e.target;
      while(t && t!==sectionsWrap){
        if(t.classList && t.classList.contains('part')){
          const ds=t.dataset;
          playSegment(ds.start, ds.end);
          return;
        }
        t=t.parentElement;
      }
    });

    sectionsWrap.addEventListener('keydown', (e)=>{
      if(e.key!=='Enter' && e.key!==' ') return;
      let t=e.target;
      while(t && t!==sectionsWrap){
        if(t.classList && t.classList.contains('part')){
          e.preventDefault();
          const ds=t.dataset;
          playSegment(ds.start, ds.end);
          return;
        }
        t=t.parentElement;
      }
    });
  }

  init();
</script>
</body>
</html>